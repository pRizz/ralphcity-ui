---
phase: 06-repository-manager
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/ralphtown/RepositoryManagerDialog.tsx
  - frontend/src/components/ralphtown/AgentSidebar.tsx
autonomous: true

must_haves:
  truths:
    - "User can access a repository manager view from the sidebar footer"
    - "User can see all tracked repositories with name, path, and added date"
    - "User can delete a repository with confirmation (removes from DB, files remain on disk)"
    - "User can initiate clone from the manager view (opens existing CloneDialog)"
  artifacts:
    - path: "frontend/src/components/ralphtown/RepositoryManagerDialog.tsx"
      provides: "Repository manager dialog component"
      min_lines: 100
      contains: "useRepos"
    - path: "frontend/src/components/ralphtown/AgentSidebar.tsx"
      provides: "Trigger button in footer"
      contains: "RepositoryManagerDialog"
  key_links:
    - from: "RepositoryManagerDialog.tsx"
      to: "useRepos hook"
      via: "TanStack Query hook call"
      pattern: "useRepos\\(\\)"
    - from: "RepositoryManagerDialog.tsx"
      to: "useDeleteRepo hook"
      via: "TanStack Query mutation"
      pattern: "useDeleteRepo\\(\\)"
    - from: "RepositoryManagerDialog.tsx"
      to: "CloneDialog"
      via: "Component render with open state"
      pattern: "CloneDialog.*open="
    - from: "AgentSidebar.tsx"
      to: "RepositoryManagerDialog"
      via: "Component render in footer"
      pattern: "<RepositoryManagerDialog"
---

<objective>
Create a Repository Manager dialog that allows users to view, manage, and delete tracked repositories.

Purpose: Provide a dedicated interface for repository CRUD operations outside the main workflow.
Output: Working RepositoryManagerDialog component integrated into the sidebar footer.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-repository-manager/06-RESEARCH.md

# Existing patterns to follow
@frontend/src/components/ralphtown/SettingsDialog.tsx
@frontend/src/components/ralphtown/CloneDialog.tsx
@frontend/src/components/ralphtown/AgentSidebar.tsx
@frontend/src/api/hooks.ts
@frontend/src/api/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RepositoryManagerDialog component</name>
  <files>frontend/src/components/ralphtown/RepositoryManagerDialog.tsx</files>
  <action>
Create a new dialog component following the established SettingsDialog pattern:

1. **Dialog structure:**
   - Use shadcn/ui Dialog with DialogTrigger showing "Manage" button (text, not icon-only)
   - DialogContent with max-width ~600px for table display
   - DialogHeader with title "Manage Repositories" and description

2. **Table display:**
   - Use shadcn/ui Table component
   - Columns: Name, Path, Added (formatted date), Actions (delete button)
   - Use `useRepos()` hook to fetch repositories
   - Format `created_at` using date-fns `format()` with 'MMM d, yyyy' pattern
   - Handle empty state: show message "No repositories yet" with prompt to clone

3. **Delete functionality:**
   - Each row has a Trash2 icon button
   - Click opens AlertDialog for confirmation
   - Use state: `repoToDelete: Repo | null` to track which repo is pending deletion
   - AlertDialog text: "Delete Repository?" / "This will remove '{name}' from the list. The files on disk will not be deleted."
   - Use `useDeleteRepo()` mutation for actual deletion
   - Show toast on success/error using `useToast()`

4. **Clone integration:**
   - Add "Clone Repository" button in dialog (above table or in header area)
   - Render CloneDialog with controlled open state
   - On clone success: close both dialogs OR just close CloneDialog (manager shows updated list via query invalidation)
   - Pass `onCloneSuccess` that toasts success (CloneDialog already handles adding to list)

5. **Imports needed:**
   - Dialog components from "@/components/ui/dialog"
   - AlertDialog components from "@/components/ui/alert-dialog"
   - Table components from "@/components/ui/table"
   - Button from "@/components/ui/button"
   - useRepos, useDeleteRepo from "@/api/hooks"
   - useToast from "@/hooks/use-toast"
   - CloneDialog from "./CloneDialog"
   - format from "date-fns"
   - Trash2, Plus icons from "lucide-react"
   - Repo type from "@/api/types"
  </action>
  <verify>
    - File exists: `ls frontend/src/components/ralphtown/RepositoryManagerDialog.tsx`
    - No TypeScript errors: `cd frontend && npx tsc --noEmit`
  </verify>
  <done>
    - RepositoryManagerDialog component renders table of repos with name, path, date, delete action
    - AlertDialog confirms before delete
    - CloneDialog can be opened from within manager
    - Uses existing hooks for data fetching and mutations
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate RepositoryManagerDialog into AgentSidebar</name>
  <files>frontend/src/components/ralphtown/AgentSidebar.tsx</files>
  <action>
Modify AgentSidebar to add the repository manager trigger in the footer:

1. **Import:**
   - Add: `import { RepositoryManagerDialog } from "./RepositoryManagerDialog";`

2. **Footer modification (around line 157):**
   Current footer structure:
   ```tsx
   <div className="px-3 py-3 border-t border-sidebar-border mt-auto flex items-center justify-between">
     <a href="https://github.com/pRizz/ralphtown" ...>
       {/* GitHub link */}
     </a>
     <SettingsDialog />
   </div>
   ```

   Change to:
   ```tsx
   <div className="px-3 py-3 border-t border-sidebar-border mt-auto flex items-center justify-between">
     <a href="https://github.com/pRizz/ralphtown" ...>
       {/* GitHub link */}
     </a>
     <div className="flex items-center gap-1">
       <RepositoryManagerDialog />
       <SettingsDialog />
     </div>
   </div>
   ```

3. The RepositoryManagerDialog component includes its own DialogTrigger (a "Manage" button), so just rendering it adds the trigger.
  </action>
  <verify>
    - No TypeScript errors: `cd frontend && npx tsc --noEmit`
    - Build succeeds: `cd frontend && npm run build`
    - Visual check: Start dev server, verify "Manage" button appears in sidebar footer next to settings icon
  </verify>
  <done>
    - "Manage" button visible in sidebar footer
    - Clicking opens repository manager dialog
    - Full workflow: view repos, delete repo, clone new repo
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Build verification:**
   ```bash
   cd frontend && npm run build
   ```

2. **Functional verification (requires running backend):**
   - Start application
   - Click "Manage" in sidebar footer
   - Dialog opens showing list of repositories
   - Each repo shows name, path, and added date
   - Click trash icon on a repo -> confirmation dialog appears
   - Confirm delete -> repo removed from list, toast shown
   - Click "Clone Repository" -> CloneDialog opens
   - After successful clone -> new repo appears in list
</verification>

<success_criteria>
- [ ] RepositoryManagerDialog.tsx exists with table display and delete confirmation
- [ ] AgentSidebar.tsx imports and renders RepositoryManagerDialog in footer
- [ ] `npm run build` succeeds with no errors
- [ ] User can access manager from sidebar footer
- [ ] User can see all repos with name, path, date
- [ ] User can delete repo with confirmation
- [ ] User can initiate clone from manager
</success_criteria>

<output>
After completion, create `.planning/phases/06-repository-manager/06-01-SUMMARY.md`
</output>
